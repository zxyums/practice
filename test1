import React from 'react';
import ExcelJS from 'exceljs';
import { saveAs } from 'file-saver';
// Import the Excel file from the components folder
import yourExcelFile from './your-file.xlsx'; // Adjust the path according to your folder structure

const ExcelProcessor: React.FC = () => {
  const handleFileProcess = async () => {
    try {
      // Step 1: Fetch the imported file as Blob (handled by Vite's asset system)
      const response = await fetch(yourExcelFile); 
      if (!response.ok) {
        throw new Error(`Error fetching the file: ${response.statusText}`);
      }
      const blob = await response.blob();

      // Step 2: Create a new workbook using ExcelJS
      const workbook = new ExcelJS.Workbook();
      await workbook.xlsx.load(await blob.arrayBuffer());

      // Step 3: Access the sheet you want to modify (for example, the first sheet)
      const worksheet = workbook.getWorksheet(1); // 1 is the index for the first sheet

      // Step 4: Modify the sheet (e.g., add a new row at the end)
      worksheet.addRow(['New Data 1', 'New Data 2', 'New Data 3']);

      // Step 5: Keep drop-downs (data validation) and other formatting as they are

      // Step 6: Write the modified workbook to a buffer
      const modifiedBuffer = await workbook.xlsx.writeBuffer();

      // Step 7: Create a Blob from the modified buffer and save the modified file
      const newExcelBlob = new Blob([modifiedBuffer], {
        type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
      });

      // Step 8: Trigger file download using FileSaver
      saveAs(newExcelBlob, 'modified-file.xlsx');
    } catch (error) {
      console.error('Error processing file:', error);
    }
  };

  return (
    <div>
      <button onClick={handleFileProcess}>Process and Download Excel File</button>
    </div>
  );
};

export default ExcelProcessor;