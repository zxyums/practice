import React from 'react';
import * as XLSX from 'xlsx';
import { saveAs } from 'file-saver';

const ExcelProcessor: React.FC = () => {
  const handleFileProcess = async () => {
    try {
      const response = await fetch('/your-file.xlsx');
      const blob = await response.blob();
      const fileReader = new FileReader();

      fileReader.onload = (e) => {
        const arrayBuffer = e.target?.result as ArrayBuffer;
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });

        // Select the first sheet and get the data
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        const sheetData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        // Modify the data (example adds a new row)
        const newRow = ['New Data 1', 'New Data 2', 'New Data 3'];
        sheetData.push(newRow);

        // Create a new worksheet with the modified data
        const newWorksheet = XLSX.utils.aoa_to_sheet(sheetData);

        // Create a new workbook and append the modified worksheet
        const newWorkbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, 'Modified Sheet');

        // Step 1: Use XLSX.write to get an ArrayBuffer
        const newWorkbookArrayBuffer = XLSX.write(newWorkbook, {
          bookType: 'xlsx',
          type: 'array',
        });

        // Step 2: Convert the ArrayBuffer to a Blob
        const newExcelBlob = new Blob([newWorkbookArrayBuffer], {
          type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        });

        // Step 3: Save the Blob as an Excel file
        saveAs(newExcelBlob, 'modified-file.xlsx');
      };

      // Read the Excel file as an ArrayBuffer
      fileReader.readAsArrayBuffer(blob);
    } catch (error) {
      console.error('Error processing file:', error);
    }
  };

  return (
    <div>
      <button onClick={handleFileProcess}>Process Excel File</button>
    </div>
  );
};

export default ExcelProcessor;